!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.plugsy=t():e.plugsy=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9);class i{constructor(){this.parserFlags=r.NodeFlags.None,this.attrList={},this.applyAttributePropertyBindings()}static get defaultStringificationParams(){return{attrParen:'"',indentChar:"\t",newlineChar:"\n"}}get parentNode(){return this._parentNode}getAllAttributeNames(){return Object.keys(this.attrList)}getNumberOfAttributes(){return this.getAllAttributeNames().length}hasAttribute(e){return-1!==this.getAllAttributeNames().indexOf(e)}getAttribute(e,t){if("object"==typeof this.attrList&&null!==this.attrList)return e=i.joinAttributeNameWithNamespacePrefix(e,t),this.attrList[e]}setAttribute(e,t,n){return e=i.joinAttributeNameWithNamespacePrefix(e,n),this.attrList=this.attrList||{},this.attrList[e]=t,this}removeAttribute(e,t){return e=i.joinAttributeNameWithNamespacePrefix(e,t),delete this.attrList[e],this}toFormattedString(e){return e="object"==typeof e&&null!==e?i.mergeObjects(i.defaultStringificationParams,e):i.defaultStringificationParams,this.stringify(e)}toString(){return this.stringify({indentChar:"",newlineChar:"",attrParen:'"'})}isTagNameAndNamespaceIdenticalTo(e){return this.namespacePrefix===e.namespacePrefix&&this.tagName===e.tagName}isAttributeListIdenticalTo(e){if(this.getNumberOfAttributes()!==e.getNumberOfAttributes())return!1;return-1===this.getAllAttributeNames().findIndex(t=>this.getAttribute(t)!==e.getAttribute(t))}isIdenticalTo(e){return this.constructor===e.constructor&&this.isTagNameAndNamespaceIdenticalTo(e)&&this.isAttributeListIdenticalTo(e)}static attributePropertyBinding(e){return(t,n)=>{t.addAttributeProxyProperty(n,e)}}getBoundAttributeNameForProperty(e){if("object"==typeof this.attrPropertyBindings&&null!==this.attrPropertyBindings)return this.attrPropertyBindings[e]}getBoundPropertyNamesForAttribute(e){const t=[];if("object"!=typeof this.attrPropertyBindings||null===this.attrPropertyBindings)return t;for(let n in this.attrPropertyBindings)this.attrPropertyBindings[n]===e&&t.push(n);return t}static joinAttributeNameWithNamespacePrefix(e,t){return void 0!==t&&(e=t+":"+e),e}static changeParentNode(e,t){e._parentNode=t}static removeParentNode(e){e._parentNode=void 0}static generateIndentString(e,t){if(0===(t=Math.max(t||0,0)))return"";let n="";for(;t-- >0;)n+=e;return n}stringify(e,t){return t=Math.max(t||0,0),`${i.generateIndentString(e.indentChar,t)}<${this.tagName}${this.stringifyAttributes(t)} />${e.newlineChar}`}stringifyAttributes(e){var t="";for(let e in this.attrList)t+=this.stringifyAttribute(e,this.attrList[e]);return t}stringifyAttribute(e,t){return void 0!==t?` ${e}="${t}"`:` ${e}`}static mergeObjects(e,t){for(let n in t)e[n]=t[n];return e}addAttributeProxyProperty(e,t){this.attrPropertyBindings=this.attrPropertyBindings||{},this.attrPropertyBindings[e]=t}applyAttributePropertyBindings(){if("object"==typeof this.attrPropertyBindings&&null!==this.attrPropertyBindings)for(let e in this.attrPropertyBindings)this.applyAttributePropertyBinding(e,this.attrPropertyBindings[e])}applyAttributePropertyBinding(e,t){const n=this[e];Object.defineProperty(this,e,{get:()=>this.getAttribute(t),set:e=>this.setAttribute(t,e)}),this.setAttribute(t,n)}}t.Node=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.UnexpectedToken=1]="UnexpectedToken",e[e.MissingTagNameAfterNamespacePrefix=2]="MissingTagNameAfterNamespacePrefix",e[e.MissingAttrNameAfterAttrPrefix=3]="MissingAttrNameAfterAttrPrefix",e[e.IllegalNamespacePrefix=4]="IllegalNamespacePrefix",e[e.IllegalSelfClose=5]="IllegalSelfClose",e[e.ExcessCloseTag=6]="ExcessCloseTag",e[e.InvalidTagName=7]="InvalidTagName"}(t.SyntaxErrorCode||(t.SyntaxErrorCode={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),s=n(0),o=n(12),a=n(10),u=n(7),c=n(11),d=n(1),h=n(6),l=n(5),g=n(4),f=n(3),T=n(9);class p{constructor(e){this.stringToParse=e,this.defaultTagSyntaxRule=p.createDefaultTagSyntaxRule(),this.tagSyntaxRules={},this.ast=new a.DocumentNode,this.currentContainerNode=this.getAst(),this.currentTokenIndex=0}static createForXmlString(e){return new p(e)}static parseString(e,t){return r(this,void 0,void 0,function*(){const n=p.createForXmlString(e);return(t instanceof f.SyntaxRuleSet||f.SyntaxRuleSet.isSyntaxRuleSetClass(t))&&n.applySyntaxRuleSet(t),n.parseComplete(),n})}static parseStringToAst(e,t){return r(this,void 0,void 0,function*(){return(yield p.parseString(e,t)).getAst()})}getDefaultTagSyntaxRule(){return this.defaultTagSyntaxRule}setDefaultTagSyntaxRule(e){this.defaultTagSyntaxRule=e}getTagSyntaxRuleForTagName(e){return this.tagSyntaxRules[e]||void 0}hasTagSyntaxRuleForTagName(e){const t=this.getTagSyntaxRuleForTagName(e);return"object"==typeof t&&null!==t}addTagSyntaxRule(e){return e.getTagNames().forEach(t=>{this.tagSyntaxRules[t]=e}),this}addTagSyntaxRules(...e){return e.forEach(e=>this.addTagSyntaxRule(e)),this}removeTagSyntaxRuleForTagName(e){return this.tagSyntaxRules[e]=void 0,this}removeTagSyntaxRulesForTagNames(e){return e.forEach(e=>this.removeTagSyntaxRuleForTagName(e)),this}applySyntaxRuleSet(e){return f.SyntaxRuleSet.isSyntaxRuleSetClass(e)&&(e=e.createInstance()),this.addTagSyntaxRules(...e.getAllTagSyntaxRules()),this}getAst(){return this.ast}parseComplete(){if(!(this.stringToParse.length<1))for(;!this.isAtEndOfInput();)this.parseFromCurrentToken()}getCurrentLine(){const e=this.getTokenMatrix();return e[this.getCurrentTokenIndex()]?e[this.getCurrentTokenIndex()].line:0===this.getCurrentTokenIndex()?1:void 0}getCurrentColumn(){const e=this.getTokenMatrix();return e[this.getCurrentTokenIndex()]?e[this.getCurrentTokenIndex()].column:0===this.getCurrentTokenIndex()?1:void 0}getCurrentTokenIndex(){return this.currentTokenIndex}isAtEndOfInput(){return this.getCurrentTokenIndex()>=this.stringToParse.length}getTokenAtIndex(e){return this.stringToParse[e]}getCurrentToken(){return this.getTokenAtIndex(this.getCurrentTokenIndex())}getTokenRange(e,t){return this.stringToParse.slice(e,t)}getTokenRangeStartingAt(e,t){return this.stringToParse.slice(e,e+t)}getNextToken(){return this.getTokenAtIndex(this.getCurrentTokenIndex()+1)}getPreviousToken(){return this.getTokenAtIndex(this.getCurrentTokenIndex()-1)}findFirstOccurenceOfTokenAfterIndex(e,t){return this.stringToParse.indexOf(e[0],t)}doesTokenOccurBeforeNextOccurenceOfOtherToken(e,t,n){const r=this.findFirstOccurenceOfTokenAfterIndex(e,n),i=this.findFirstOccurenceOfTokenAfterIndex(t,n);return!(r<0||i<0)&&r<i}getCurrentContainerNode(){return this.currentContainerNode}descendInto(e){this.currentContainerNode=e}ascend(){this.currentContainerNode.parentNode instanceof u.ContainerNode||this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.Unknown,"can not ascend: current containing node has no parent node")),this.currentContainerNode=this.currentContainerNode.parentNode}createSyntaxError(e,t,n,r){return new h.SyntaxError(e,t,n,this.stringToParse,r)}createSyntaxErrorAtCurrentToken(e,t){return this.createSyntaxError(e,this.getCurrentLine(),this.getCurrentColumn(),t)}createUnexpectedTokenSyntaxErrorAtCurrentToken(e){return e=e||"token can not be parsed",this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.UnexpectedToken,e)}raiseError(e){throw e}static isSingularCloseMode(e){return e in l.TagCloseMode}static createDefaultTagSyntaxRule(){const e=g.TagSyntaxRule.createForTagName(void 0);return e.setCloseMode(l.TagCloseMode.Tag|l.TagCloseMode.SelfClose),e}getOverrideOrDefaultTagSyntaxRuleForTagName(e){return this.getTagSyntaxRuleForTagName(e)||this.getDefaultTagSyntaxRule()}getAllowedTagCloseModesForTagName(e){return this.getOverrideOrDefaultTagSyntaxRuleForTagName(e).getCloseMode()}isCloseModeAllowedForTagName(e,t){if(!p.isSingularCloseMode(t))throw new Error("Rule lookup failed: tag close mode must not be a combination of close modes.");return(this.getAllowedTagCloseModesForTagName(e)&t)===t}static isAlphabeticToken(e){return/[a-z]/i.test(e[0])}static isNumericToken(e){return/[0-9]/i.test(e[0])}static isWhitespaceToken(e){return" "===(e=e[0])||"\t"===e||"\r"===e||"\n"===e}static isTokenLegalInTagNameOrTagNameNamespacePrefix(e){return p.isAlphabeticToken(e)||p.isNumericToken(e)||"-"===e[0]||"_"===e[0]||"."===e[0]}static isTokenLegalInAttributeNameOrAttributeNameNameNamespacePrefix(e){return p.isAlphabeticToken(e)||p.isNumericToken(e)||"-"===e[0]||"_"===e[0]}moveByNumberOfTokens(e){this.currentTokenIndex+=e}goBackByNumberOfTokens(e){this.moveByNumberOfTokens(0-Math.abs(e))}goBackToPreviousToken(){this.goBackByNumberOfTokens(1)}advanceByNumberOfTokens(e){this.moveByNumberOfTokens(Math.abs(e))}advanceToNextToken(){this.advanceByNumberOfTokens(1)}parseFromCurrentToken(){if(!this.isAtEndOfInput())switch(!0){default:this.parseIntoNewTextNode();break;case"string"!=typeof this.getCurrentToken():case p.isWhitespaceToken(this.getCurrentToken())||"\r"===this.getCurrentToken()||"\n"===this.getCurrentToken():this.advanceToNextToken();break;case"<"===this.getCurrentToken():this.parseFromOpenAngleBracket()}}parseFromOpenAngleBracket(){"!"===this.getNextToken()||"?"===this.getNextToken()||!this.doesTokenOccurBeforeNextOccurenceOfOtherToken("<",">",this.getCurrentTokenIndex()+1)||this.doesTokenOccurBeforeNextOccurenceOfOtherToken('"',"<",this.getCurrentTokenIndex()+1)||this.doesTokenOccurBeforeNextOccurenceOfOtherToken("'","<",this.getCurrentTokenIndex()+1)?this.parseFromBeginningOfTag():this.parseIntoNewTextNode()}parseIntoNewTextNode(){const e=new i.TextNode;for(e.content="",this.getCurrentContainerNode().appendChild(e);p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();for(;!this.isAtEndOfInput()&&("<"!==this.getCurrentToken()||this.doesTokenOccurBeforeNextOccurenceOfOtherToken("<",">",this.getCurrentTokenIndex()+1));)e.content+=this.getCurrentToken(),this.advanceToNextToken()}parseFromBeginningOfTag(){switch(!0){default:this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected exclamation mark, question mark or alphabetic tag name"));break;case p.isTokenLegalInTagNameOrTagNameNamespacePrefix(this.getNextToken()):this.parseFromBeginningOfNormalNode();break;case"</"===this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2):this.parseFromBeginningOfCloseTag();break;case"!"===this.getNextToken():switch(!0){default:this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected declaration opener or comment node"));break;case"[CDATA["===this.getTokenRangeStartingAt(this.getCurrentTokenIndex()+2,7):this.parseFromBeginningOfCDataSectionNode();break;case p.isAlphabeticToken(this.getTokenAtIndex(this.getCurrentTokenIndex()+2)):this.parseFromBeginningOfDeclarationOpenerNode();break;case"--"===this.getTokenRangeStartingAt(this.getCurrentTokenIndex()+2,2):this.parseFromBeginningOfCommentNode()}break;case"?"===this.getNextToken():this.parseFromBeginningOfProcessingInstructionNode()}}parseFromBeginningOfNormalNode(){p.isTokenLegalInTagNameOrTagNameNamespacePrefix(this.getNextToken())||this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken(`expected beginning of tag name, got '${this.getNextToken()}'`));const e=new o.SelfClosingNode;this.getCurrentContainerNode().appendChild(e),this.advanceToNextToken(),"."===this.getCurrentToken()&&this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.InvalidTagName,`expected beginning of tag name, got '${this.getCurrentToken()}'`)),this.parseCompleteOpeningTagInto(e,!0,!1)}findUnclosedNodeMatchingTagName(e){var t=this.getCurrentContainerNode();do{if(!(t.parserFlags&T.NodeFlags.Closed||t.namespacePrefix!==e.namespacePrefix||t.tagName!==e.tagName))return t}while((t=t.parentNode)&&t.parentNode instanceof s.Node)}parseFromBeginningOfCloseTag(){if("</"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2)){const e=`expected beginning of close tag (</...), got '${this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2)}'`;this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken(e))}this.advanceByNumberOfTokens(2);const e=this.parseTagName();this.findUnclosedNodeMatchingTagName(e)instanceof u.ContainerNode||this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.ExcessCloseTag,`close tag '${e.tagName}' has no open tag`)),">"!==this.getCurrentToken()&&this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken(`expected end of close tag, got '${this.getCurrentToken()}'`)),this.advanceToNextToken(),this.ascend()}parseFromBeginningOfDeclarationOpenerNode(){"<!"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2)&&this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected beginning of declaration opener (<!)"));const e=new i.DeclarationOpenerNode;this.getCurrentContainerNode().appendChild(e),this.advanceByNumberOfTokens(2),this.parseCompleteOpeningTagInto(e,!1,!0)}parseFromBeginningOfProcessingInstructionNode(){"<?"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2)&&this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected beginning of processing instruction (<?)"));const e=new i.ProcessingInstructionNode;this.getCurrentContainerNode().appendChild(e),this.advanceByNumberOfTokens(2),this.parseCompleteOpeningTagInto(e,!1,!1)}parseFromBeginningOfCDataSectionNode(){"<![CDATA["!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),9)&&this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected beginning of CDATA section (<![CDATA[)"));const e=new i.CDataSectionNode;for(this.getCurrentContainerNode().appendChild(e),this.advanceByNumberOfTokens(9),e.content="";"]]>"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),3);)e.content+=this.getCurrentToken(),this.advanceToNextToken();this.advanceByNumberOfTokens(3)}parseFromBeginningOfCommentNode(){"\x3c!--"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),4)&&this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected beginning of comment (\x3c!--)"));const e=new i.CommentNode;for(this.getCurrentContainerNode().appendChild(e),this.advanceByNumberOfTokens(4),e.content="";"--\x3e"!==this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),3);)e.content+=this.getCurrentToken(),this.advanceToNextToken();this.advanceByNumberOfTokens(3)}static createContainerNodeFromOtherNode(e){const t=new u.ContainerNode;return t.namespacePrefix=e.namespacePrefix,t.tagName=e.tagName,e.getAllAttributeNames().forEach(n=>t.setAttribute(n,e.getAttribute(n))),t}static createVoidNodeFromOtherNode(e){const t=new c.VoidNode;return t.namespacePrefix=e.namespacePrefix,t.tagName=e.tagName,e.getAllAttributeNames().forEach(n=>t.setAttribute(n,e.getAttribute(n))),t}parseCompleteOpeningTagInto(e,t,n){for(this.parseTagNameInto(e),"?"!==this.getCurrentToken()&&">"!==this.getCurrentToken()&&this.parseAttributeListInto(e,n);p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();switch(!0){default:this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected end of opening tag"));break;case"/>"===this.getTokenRangeStartingAt(this.getCurrentTokenIndex(),2):return this.isCloseModeAllowedForTagName(e.tagName,l.TagCloseMode.SelfClose)||this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.IllegalSelfClose,`tag '${e.tagName}' must not self-close`)),e.parserFlags|=T.NodeFlags.SelfClosing,void this.advanceByNumberOfTokens(2);case"?"===this.getCurrentToken():this.advanceToNextToken();case">"===this.getCurrentToken():this.parseEndOfNonSelfClosingOpeningTag(e,t),this.advanceToNextToken()}}parseEndOfNonSelfClosingOpeningTag(e,t){if(e instanceof o.SelfClosingNode)if(this.isCloseModeAllowedForTagName(e.tagName,l.TagCloseMode.Void)){const t=p.createVoidNodeFromOtherNode(e);e.parentNode.replaceChild(e,t),(e=t).parserFlags|=T.NodeFlags.Void}else{const n=p.createContainerNodeFromOtherNode(e);e.parentNode.replaceChild(e,n),e.parserFlags|=T.NodeFlags.Opened,t&&this.descendInto(n)}}parseTagName(){for(var e=!1,t="",n={namespacePrefix:void 0,tagName:void 0};p.isTokenLegalInTagNameOrTagNameNamespacePrefix(this.getCurrentToken())||":"===this.getCurrentToken();){if(":"===this.getCurrentToken()&&(e&&this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.IllegalNamespacePrefix,"illegal multiple namespace prefix (multiple colons in tag name)")),e=!0,n.namespacePrefix=t,t="",this.advanceToNextToken(),!p.isAlphabeticToken(this.getCurrentToken())))return void this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.MissingTagNameAfterNamespacePrefix,"namespace prefix must be followed by a tag name"));t+=this.getCurrentToken(),this.advanceToNextToken()}return n.tagName=t,n}parseTagNameInto(e){const t=this.parseTagName();e.namespacePrefix=t.namespacePrefix,e.tagName=t.tagName}parseAttributeListInto(e,t){for(p.isWhitespaceToken(this.getCurrentToken())||"/"===this.getCurrentToken()||">"===this.getCurrentToken()||t||'"'!==this.getCurrentToken()||this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("expected whitespace or end of opening tag"));p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();if(p.isAlphabeticToken(this.getCurrentToken())||t||'"'===this.getCurrentToken())for(;">"!==this.getCurrentToken()&&"/"!==this.getCurrentToken()&&"?"!==this.getCurrentToken();)if('"'===this.getCurrentToken())t||this.raiseError(this.createUnexpectedTokenSyntaxErrorAtCurrentToken("system literal not allowed on this node")),e.appendToSystemLiteralList(this.parseLiteral());else{let t=this.parseAttribute();if(""===t.name)continue;for(e.setAttribute(t.name,t.value);p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken()}}parseLiteral(){for(var e="";p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();const t=this.getCurrentToken();for(;!this.isAtEndOfInput()&&(this.advanceToNextToken(),this.getCurrentToken()!==t);)e+=this.getCurrentToken();return this.advanceToNextToken(),e}parseAttribute(){for(var e,t,n="",r=!1,i=()=>({name:n,value:e});p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();for(;p.isTokenLegalInAttributeNameOrAttributeNameNameNamespacePrefix(this.getCurrentToken())||":"===this.getCurrentToken();){if(":"===this.getCurrentToken()&&(r&&this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.IllegalNamespacePrefix,"illegal multiple namespace prefix (multiple colons in tag name)")),r=!0,!p.isAlphabeticToken(this.getNextToken())))return void this.raiseError(this.createSyntaxErrorAtCurrentToken(d.SyntaxErrorCode.MissingTagNameAfterNamespacePrefix,"namespace prefix must be followed by a tag name"));n+=this.getCurrentToken(),this.advanceToNextToken()}for(;p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();if("="!==this.getCurrentToken())return i();if(this.advanceToNextToken(),p.isWhitespaceToken(this.getCurrentToken())||'"'===this.getCurrentToken()||"'"===this.getCurrentToken()){for(;p.isWhitespaceToken(this.getCurrentToken());)this.advanceToNextToken();if('"'!==this.getCurrentToken()&&"'"!==this.getCurrentToken())return i();t=this.getCurrentToken()}for(e="";!this.isAtEndOfInput();){if(this.advanceToNextToken(),this.getCurrentToken()===t){this.advanceToNextToken();break}e+=this.getCurrentToken()}return i()}getTokenMatrix(){return"object"==typeof this.tokenMatrix&&null!==this.tokenMatrix||this.createTokenMatrix(),this.tokenMatrix}createTokenMatrix(){var e=1,t=0;this.tokenMatrix=new Array(this.stringToParse.length);for(let n=0;n<this.stringToParse.length;n++){t+=1;const r=this.stringToParse[n];this.tokenMatrix[n]={line:e,column:t},"\n"===r&&(e+=1,t=0)}}}t.Parser=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.tagSyntaxRules=[]}static createInstance(){return new this}static isSyntaxRuleSetClass(e){return"function"==typeof e&&e._syntaxRuleSetBrand_===r._syntaxRuleSetBrand_}hasTagSyntaxRule(e){return-1!==this.tagSyntaxRules.indexOf(e)}getAllTagSyntaxRules(){return[].concat(this.tagSyntaxRules)}addTagSyntaxRule(e){return this.hasTagSyntaxRule(e)||this.tagSyntaxRules.push(e),this}addTagSyntaxRules(...e){return e.forEach(e=>this.addTagSyntaxRule(e)),this}}r._syntaxRuleSetBrand_=Math.random(),t.SyntaxRuleSet=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.tagNames=e}static createForTagName(e){return new r([e])}static createForTagNames(...e){return new r(e.filter((e,t,n)=>n.indexOf(e)===t))}getTagNames(){return[].concat(this.tagNames)}appliesToTagName(e){return-1!==this.tagNames.indexOf(e)}getCloseMode(){return this.closeMode}setCloseMode(e){return this.closeMode=e,this}}t.TagSyntaxRule=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Tag=1]="Tag",e[e.SelfClose=2]="SelfClose",e[e.Void=4]="Void"}(t.TagCloseMode||(t.TagCloseMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);class i extends Error{constructor(e,t,n,r,i){super(i),this.errorCode=e,this.line=t,this.column=n,this.source=r,this.source=this.source||""}static getSyntaxErrorCodeName(e){return r.SyntaxErrorCode[e]}getMessage(){return this.message}getErrorCode(){return this.errorCode}getErrorName(){return i.getSyntaxErrorCodeName(this.getErrorCode())}getLine(){return this.line}getColumn(){return this.column}toString(){return`syntax error [${this.getErrorCode()} ${this.getErrorName()}] at token '${this.getTokenAt(this.line,this.column)}' ${this.getLine()}, ${this.getColumn()}: ${this.getMessage()}`}getTokenAt(e,t){const n=this.source.split(/\n/)[e-1];return"string"!=typeof n?"":n.split("")[t-1]}}t.SyntaxError=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.ContainerNode=class extends r.Node{constructor(){super(...arguments),this.childNodes=[]}getNumberOfChildren(){return this.childNodes.length}getChildAtIndex(e){return this.childNodes[e]}getIndexOfChild(e){return this.childNodes.indexOf(e)}hasChild(e){return-1!==this.getIndexOfChild(e)}insertChildAt(e,t){return r.Node.changeParentNode(e,this),this.childNodes.splice(t,0,e),this}removeChildAt(e){const t=this.childNodes.splice(e,1)[0];return r.Node.removeParentNode(t),this}insertChildBefore(e,t){if(!this.hasChild(t))throw new Error("Can not insert child: reference child not found.");return this.insertChildAt(e,this.getIndexOfChild(t)),this}insertChildAfter(e,t){if(!this.hasChild(t))throw new Error("Can not insert child: reference child not found.");return this.insertChildAt(e,this.getIndexOfChild(t)+1),this}prependChild(e){return this.insertChildAt(e,0),this}appendChild(e){return this.insertChildAt(e,this.getNumberOfChildren()),this}replaceChild(e,t){const n=this.getIndexOfChild(e);return this.removeChildAt(n),this.insertChildAt(t,n),this}forEachChildNode(e){this.childNodes.forEach((t,n)=>e(t,n))}isSubtreeIdenticalTo(e){if(this.getNumberOfChildren()!==e.getNumberOfChildren())return!1;for(let t=0;t<this.getNumberOfChildren();t++)if(!this.getChildAtIndex(t).isIdenticalTo(e.getChildAtIndex(t)))return!1;return!0}isIdenticalTo(e){return super.isIdenticalTo(e)&&this.isSubtreeIdenticalTo(e)}stringify(e,t){return t=Math.max(t||0,0),`${r.Node.generateIndentString(e.indentChar,t)}<${this.tagName}${this.stringifyAttributes(t)}>${this.stringifyAllChildNodes(e,t)}${r.Node.generateIndentString(e.indentChar,t)}</${this.tagName}>${e.newlineChar}`}stringifyAllChildNodes(e,t){var n=e.newlineChar;return this.forEachChildNode(r=>{n+=this.stringifyChildNode(r,e,t+1)}),n}stringifyChildNode(e,t,n){return e.stringify(t,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);class i extends r.Node{getContentLines(){return"string"!=typeof this.content||this.content.length<1?[]:this.content.trim().split(/\r?\n/)}isContentMultiLine(){return/\r?\n/.test(this.content.trim())}isContentIdenticalTo(e){return i.makeContentStringComparable(this.content||"")===i.makeContentStringComparable(e.content||"")}isIdenticalTo(e){return super.isIdenticalTo(e)&&this.isContentIdenticalTo(e)}static makeContentStringComparable(e){return e.trim().replace(/[\t\r\n ]+/g,"").replace(/ +/g," ")}stringify(e,t){return this.stringifyContent(e,t)}stringifyContent(e,t){return this.isContentMultiLine()?this.stringifyMultiLineContent(e,t):this.stringifySingleLineContent(e,t)}stringifyMultiLineContent(e,t){var n="",i=e.newlineChar;return/\n/.test(e.newlineChar)||(i=" "),n+=this.getContentLines().map(n=>r.Node.generateIndentString(e.indentChar,t)+n.trim()).join(i),/\n/.test(e.newlineChar)?n+e.newlineChar:n}stringifySingleLineContent(e,t){const n=(this.content||"").trim().replace(/(\r?\n(\t*))+/g," ").trim();return/\n/.test(e.newlineChar)?r.Node.generateIndentString(e.indentChar,t)+n+"\n":n}}t.TextNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.Opened=1]="Opened",e[e.Closed=2]="Closed",e[e.SelfClosing=7]="SelfClosing",e[e.Void=15]="Void"}(t.NodeFlags||(t.NodeFlags={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7);t.DocumentNode=class extends r.ContainerNode{stringify(e,t){return t=Math.max(t||0,0),this.stringifyAllChildNodes(e,t)}stringifyAllChildNodes(e,t){var n="";return this.forEachChildNode(r=>{n+=this.stringifyChildNode(r,e,t)}),n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.VoidNode=class extends r.Node{stringify(e,t){return t=Math.max(t||0,0),`${r.Node.generateIndentString(e.indentChar,t)}<${this.tagName}${this.stringifyAttributes(t)}>${e.newlineChar}`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SelfClosingNode=class extends r.Node{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(24);t.Attribute=r.Attribute;const i=n(0);t.Node=i.Node;const s=n(12);t.SelfClosingNode=s.SelfClosingNode;const o=n(11);t.VoidNode=o.VoidNode;const a=n(8);t.TextNode=a.TextNode;const u=n(23);t.CommentNode=u.CommentNode;const c=n(22);t.CDataSectionNode=c.CDataSectionNode;const d=n(21);t.DeclarationOpenerNode=d.DeclarationOpenerNode;const h=n(20);t.ProcessingInstructionNode=h.ProcessingInstructionNode;const l=n(7);t.ContainerNode=l.ContainerNode;const g=n(10);t.DocumentNode=g.DocumentNode},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(13);t.ast=r;const i=n(19);t.parser=i;const s=n(1);t.SyntaxErrorCode=s.SyntaxErrorCode;const o=n(6);t.SyntaxError=o.SyntaxError;const a=n(2);t.Parser=a.Parser;const u=n(16);t.Compiler=u.Compiler},function(e,t,n){"use strict";n.r(t);const r="$$plugsy.isCommand$$",i="$$plugsy.toPersist$$",s="$$plugsy.isPersisted$$",o="undefined"!=typeof window;function a(e){Object.defineProperty(e,r,{value:!0})}var u=function(e,t){return"function"==typeof e?(a(e),e):void a(e[t])};var c,d=function(e,t){if(!t)return function(e){const t=new Object(e);return e&&!e[i]&&(Object.defineProperty(t,i,{value:!0}),Object.defineProperty(t,s,{value:e})),t}(e);e[i]=e[i]?e[i].concat(t):[t]};c=s;var h=class{constructor(){this[c]={},this.data=[]}init(){const e=this[i]||[];for(const t in this)t in this&&this[t][i]&&-1===e.indexOf(t)&&e.push(t);for(const t of e){const e=this[t];this[s][t]=e[s]?e[s]:e,Object.defineProperty(this,t,{get:()=>this[s][t],set:e=>this[s][t]=e})}this[i]=e}};function l(e){const t={};for(const n of e[i])t[n]=e[n];return t}function g(e,t){for(const n in t)n in t&&(e=f(e,n,t[n]));return e}function f(e,t,n){const r=e[t];return Object.assign(e,{[t]:function(...e){return n.call(this,this,r?r.bind(this):r,...e)}})}var T=n(14),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};function m(e){return e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase())}function C(e){return p(this,void 0,void 0,function*(){if("string"!=typeof e)return null;let t=(yield T.Parser.parseStringToAst(e)).childNodes.map(e=>(function e(t,n={}){if(t){if(t.content)return{contents:t.content};if(t.attrList)for(const e in t.attrList)if(e in t.attrList){const r=m(e),i=t.attrList[e];n[r]=isNaN(+i)||+i!=i?void 0===i||i:+i}return t.childNodes&&(n=t.childNodes.map(t=>e(t)).reduce((e,t)=>Object.assign({},e,t),n)),t.tagName?{[t.tagName]:n}:n}})(e));return t=t.reduce((e,t)=>Object.assign({},e,t),{})})}var x=function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};const y=o&&window.corescript,N=y?window.corescript:null;class k{constructor(){this.plugins={},this.toInstall=[],this.notetags={},this.data=[],this.store={},g(y?N.Managers.DataManager:DataManager,{extractSaveContents:(e,t,n)=>{t(n),this.load(n.plugsy)},isDatabaseLoaded:(e,t)=>x(this,void 0,void 0,function*(){const e=t(),n=(e,t)=>x(this,void 0,void 0,function*(){const n=yield e;return Object.assign({},n,{[t.id]:yield C(t.note)})});this.notetags=yield y?Object.keys(N.$).filter(e=>Array.isArray(N.$[e])).reduce((e,t)=>x(this,void 0,void 0,function*(){const r=yield e;return Object.assign({},r,{[t]:yield(N.$[t]||[]).filter(e=>e&&e.note).reduce(n,{})})}),{}):Object.keys(window).filter(e=>e.startsWith("$")).filter(e=>Array.isArray(window[e])).reduce((e,t)=>x(this,void 0,void 0,function*(){const r=yield e;return Object.assign({},r,{[t]:yield(window[t]||[]).filter(e=>e&&e.note).reduce(n,{})})}),{});for(const e of this.toInstall)this._install(e);return e}),loadDatabase:(e,t)=>{e._databaseFiles.push(...this.data),t()},makeSaveContents:(e,t)=>{const n=t();return n.plugsy=this.save(),n}})}save(){const e={};for(const t in this.plugins)if(this.plugins[t]){const n=this.plugins[t];e[t]=l(n)}return e}load(e){for(const t in e)e[t]&&(this.store[t]=e[t])}hydrate(e){!function(e,t){for(const n of Object.keys(t))e[n]=t[n]}(e,this.store[e.constructor.name]||{})}get(e){const t="function"==typeof e?e.name:e;return this.plugins[t]}install(e){return this.toInstall.push(e),this.data.push(...e.data),this}_install(e){e.init();const t=y?N.Game.Game_Interpreter:Game_Interpreter,n=e.constructor.name;this.hydrate(e),e.parameters=PluginManager.parameters(n),this.plugins[n]=e,g(t.prototype,{pluginCommand(t,i,s,o){i(s,o);const a=o[0];if(s.toLowerCase()===n.toLowerCase()){const t=e[a];t&&t[r]&&t.apply(e,o.slice(1))}}})}}function S(e){return new Promise((t,n)=>{const r=new XMLHttpRequest,i="data/"+e;r.open("GET",i),r.overrideMimeType("application/json"),r.onload=(()=>{r.status<400?t(JSON.parse(r.responseText)):n(r.statusText)}),r.onerror=n,r.send()})}if(n.d(t,"command",function(){return u}),n.d(t,"persist",function(){return d}),n.d(t,"loader",function(){return S}),n.d(t,"tagger",function(){return C}),n.d(t,"shimmer",function(){return g}),o){const e=window;e.corescript?e.corescript.$.plugsy=new k:e.$plugsy=new k}t.default=h},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(2);t.Compiler=class{static parseXml(e,t){return r(this,void 0,void 0,function*(){return i.Parser.parseString(e,t)})}static parseXmlToAst(e,t){return r(this,void 0,void 0,function*(){return i.Parser.parseStringToAst(e,t)})}static formatXmlString(e,t,n){return r(this,void 0,void 0,function*(){return(yield i.Parser.parseStringToAst(e,n)).toFormattedString(t)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),i=n(4),s=n(3);class o extends s.SyntaxRuleSet{static get Loose(){return class extends o{constructor(){super(!0)}}}static get Strict(){return class extends o{constructor(){super(!1)}}}constructor(e){super(),void 0===e&&(e=!0);const t=i.TagSyntaxRule.createForTagNames("area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr");e?t.setCloseMode(r.TagCloseMode.Void|r.TagCloseMode.SelfClose):t.setCloseMode(r.TagCloseMode.Void),this.addTagSyntaxRule(t)}}t.Html5=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(17);t.Html5=r.Html5},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.SyntaxErrorCode=r.SyntaxErrorCode;const i=n(6);t.SyntaxError=i.SyntaxError;const s=n(5);t.TagCloseMode=s.TagCloseMode;const o=n(4);t.TagSyntaxRule=o.TagSyntaxRule;const a=n(3);t.SyntaxRuleSet=a.SyntaxRuleSet;const u=n(9);t.NodeFlags=u.NodeFlags;const c=n(2);t.Parser=c.Parser;const d=n(18);t.ruleSet=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.ProcessingInstructionNode=class extends r.Node{stringify(e,t){return t=Math.max(t||0,0),`${r.Node.generateIndentString(e.indentChar,t)}<?${this.tagName}${this.stringifyAttributes(t)}?>${e.newlineChar}`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.DeclarationOpenerNode=class extends r.Node{constructor(){super(...arguments),this.systemLiterals=[],this.literalAndAttrOrder=[]}getNumberOfSystemLiterals(){return this.systemLiterals.length}getIndexOfSystemLiteral(e){return this.systemLiterals.indexOf(e)}getSystemLiteralAtIndex(e){return this.systemLiterals[e]}getAllSystemLiterals(){return[].concat(this.systemLiterals)}hasSystemLiteral(e){return-1!==this.getIndexOfSystemLiteral(e)}insertIntoSystemLiteralList(e,t){return this.appendSystemLiteralIndexToOrderList(t),this.systemLiterals.splice(t,0,e),this}prependToSystemLiteralList(e){return this.insertIntoSystemLiteralList(e,0),this}appendToSystemLiteralList(e){return this.insertIntoSystemLiteralList(e,this.getNumberOfSystemLiterals()),this}removeSystemLiteralAtIndex(e){return this.removeSystemLiteralIndexFromOrderList(e),this.systemLiterals.splice(e,1),this}removeSystemLiteral(e){let t=this.getIndexOfSystemLiteral(e);for(;-1!==t;)this.systemLiterals.splice(t,1),t=this.getIndexOfSystemLiteral(e);return this}setAttribute(e,t,n){return this.appendAttributeToOrderList(r.Node.joinAttributeNameWithNamespacePrefix(e,n)),super.setAttribute(e,t,n),this}removeAttribute(e,t){return this.removeAttributeFromOrderList(r.Node.joinAttributeNameWithNamespacePrefix(e,t)),super.removeAttribute(e,t),this}isSystemLiteralListIdenticalTo(e){if(this.systemLiterals.length!==e.systemLiterals.length)return!1;for(let t=0;t<this.systemLiterals.length;t++)if(this.systemLiterals[t]!==e.systemLiterals[t])return!1;return!0}isIdenticalTo(e){return super.isIdenticalTo(e)&&this.isSystemLiteralListIdenticalTo(e)}stringify(e,t){return t=Math.max(t||0,0),`${r.Node.generateIndentString(e.indentChar,t)}<!${this.tagName}${this.stringifyAttributesAndSystemLiterals(e,t)}>${e.newlineChar}`}stringifyAttributesAndSystemLiterals(e,t){return this.literalAndAttrOrder.map(e=>"string"==typeof e?this.stringifyAttribute(e,this.getAttribute(e)):` "${this.getSystemLiteralAtIndex(e)}"`).join("")}appendSystemLiteralIndexToOrderList(e){this.removeSystemLiteralIndexFromOrderList(e),this.literalAndAttrOrder.push(e)}removeSystemLiteralIndexFromOrderList(e){const t=this.literalAndAttrOrder.indexOf(e);-1!==t&&this.literalAndAttrOrder.splice(t,1)}appendAttributeToOrderList(e){this.removeAttributeFromOrderList(e),this.literalAndAttrOrder.push(e)}removeAttributeFromOrderList(e){const t=this.literalAndAttrOrder.indexOf(e);-1!==t&&this.literalAndAttrOrder.splice(t,1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);class i extends r.TextNode{stringify(e,t){return`${i.generateIndentString(e.indentChar,t)}<![CDATA[${this.stringifyContent(e,t)}]]>${e.newlineChar}`}stringifyMultiLineContent(e,t){return/\n/.test(e.newlineChar)?"\n"+super.stringifyMultiLineContent(e,t)+i.generateIndentString(e.indentChar,t):super.stringifyMultiLineContent(e,t)}stringifySingleLineContent(e,t){return(this.content||"").replace(/(\r?\n(\t*))+/g," ")}}t.CDataSectionNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);class i extends r.TextNode{stringify(e,t){return`${i.generateIndentString(e.indentChar,t)}\x3c!--${this.stringifyContent(e,t)}--\x3e${e.newlineChar}`}stringifyMultiLineContent(e,t){return/\n/.test(e.newlineChar)?"\n"+super.stringifyMultiLineContent(e,t)+i.generateIndentString(e.indentChar,t):" "+super.stringifyMultiLineContent(e,t)+" "}stringifySingleLineContent(e,t){return" "+(this.content||"").trim().replace(/(\r?\n(\t*))+/g," ").trim()+" "}}t.CommentNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static create(e){return new class extends r{constructor(){super(...arguments),this.value=e}}}valueOf(){return this.value}toString(){return this.value+""}}t.Attribute=r}])});